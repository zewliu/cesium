<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="/Build/Cesium/Cesium.js"></script>
    <link href="/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
    <style>
        html, body, #cesiumContainer {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            cursor: default;
        } 
    </style>
    <title>3D Models</title>
</head>
<body>
    <div id="cesiumContainer"></div>
    <script>
        let tdtSatImageryProvider = new Cesium.WebMapTileServiceImageryProvider({
                url: 'http://t0.tianditu.com/img_w/wmts?service=wmts&request=GetTile&version=1.0.0&LAYER=img&tileMatrixSet=w&TileMatrix={TileMatrix}&TileRow={TileRow}&TileCol={TileCol}&style=default&format=tiles&tk=7711a24780452f03bb7c02fba98183b9',
                layer: 'img',
                style: 'default',
                format: 'tiles',
                tileMatrixSetID: 'w',
                credit: new Cesium.Credit('天地图全球影像服务'),
                show:false,
        });
        let tdtLabelImageryProvider = new Cesium.WebMapTileServiceImageryProvider({
                url: 'http://t0.tianditu.com/cta_w/wmts?service=wmts&request=GetTile&version=1.0.0&LAYER=cta&tileMatrixSet=w&TileMatrix={TileMatrix}&TileRow={TileRow}&TileCol={TileCol}&style=default&format=tiles&tk=7711a24780452f03bb7c02fba98183b9',
                layer: 'cta',
                style: 'default',
                format: 'tiles',
                tileMatrixSetID: 'w',
                credit: new Cesium.Credit('天地图全球标注服务'),
                show:false,
        });
        let arcgisStreetImageryProvider = new Cesium.ArcGisMapServerImageryProvider({
            url: "http://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",
        });
        let arcgisSatImageryProvider = new Cesium.ArcGisMapServerImageryProvider({
            url: "http://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",
        });        
        // window.CESIUM_BASE_URL = "/Build/Cesium";
        Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI0NTQyOWU1Ny1mYTY3LTRlODYtYjU3OC1jN2Y1MDAyOTgzMDYiLCJpZCI6NTYxMzgsImlhdCI6MTYyMTI2ODMzN30.W6jBJEE313uIN_ftYA2p9UhJzYVJaoJfj7wvct6Nndc';
        const viewer = new Cesium.Viewer('cesiumContainer', {
            terrainProvider: Cesium.createWorldTerrain(),
            imageryProvider: arcgisStreetImageryProvider,
        });
        // viewer.scene.imageryLayers.addImageryProvider(arcgisSatImageryProvider);
        viewer.scene.globe.depthTestAgainstTerrain = true;
        const tileset = new Cesium.Cesium3DTileset({
            url: '/Specs/Data/Cesium3DTiles/Tilesets/Tileset/tileset.json'
        })

        tileset.readyPromise.then(function(tileset) {
            viewer.scene.primitives.add(tileset);
            viewer.zoomTo(tileset, new Cesium.HeadingPitchRange(0, -0.5, tileset.boundingSphere.radius * 2.0));
            const height = 100;
            const pnt = Cesium.Cartographic.fromCartesian(tileset.boundingSphere.center);
            const basePnt = Cesium.Cartesian3.fromRadians(pnt.longitude, pnt.latitude, 0);
            const targetPnt = Cesium.Cartesian3.fromRadians(pnt.longitude, pnt.latitude, height);
            const translation = Cesium.Cartesian3.subtract(targetPnt, basePnt, new Cesium.Cartesian3())
            tileset.modelMatrix = Cesium.Matrix4.fromTranslation(translation);
        }).otherwise(function(err) {
            console.log(err);
        });

    </script>
</body>
</html>